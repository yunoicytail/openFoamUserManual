### 6 维护OpenFOAM的安装
多年来，不同版本的OpenFOAM可能会在你的系统上不断累积。同时，操作系统也在不断的更新和升级。为了轻松地在系统上并行安装多个版本的OpenFOAM，就存在一个如何长期维护OpenFOAM安装的问题。

#### 6.1 应对操作系统更新
随着时间的流逝，除非在没有连接到互联网的计算机上工作，否则正在运行的操作系统将进行大量的更新。通常，对操作系统的更新不会影响你的OpenFOAM安装。如果你安装的OpenFOAM在操作系统更新后停止正常运行，则很可能存在版本冲突。在这种情况下，如清单18所示，需要从源头进行全面重建才可能解决该问题。

**故障排除提示：重新启动计算机，然后再次尝试运行，这可能会有所帮助**

操作系统更新会导致奇怪的错误。比如作者本人也遇到了这种情况，mpirun停止工作了，并且错误消息中包含堆栈跟踪，其中包含诸如内存映射之类的信息。这个问题很可能是由于更新了MPI库或（和）更新了OS内核引起的。但是，重新启动计算机后，这个问题就消失了。

仅建议不经常接收更新并且最好不连接到一般Internet的计算服务器进行长时间运行并且可以不进行重启。普通的工作站应定期重新启动并定期更新。作者经历了多次，当工作站经过几次内核更新（这些需要重新启动才能生效）后，没有重新启动的工作站开始出现异常现象。

#### 6.2 应对操作系统升级
升级操作系统后几乎总是需要从OpenFOAM的安装源进行完全重建。升级操作系统很有可能会更新OpenFOAM依赖的许多甚至所有的库和软件包。因此，在升级操作系统后尝试运行OpenFOAM的应用程序可能会导致奇怪的错误，例如OpenFOAM无法启动，因为它无法加载共享库（例如libmpi.so.XX，其中XX是版本号）。

对于更新的操作系统，系统上存在libmpi.so.YY，其中YY是与XX不同的版本号。这种轻微但奇怪的错误：OpenFOAM报告缺少libmpi库，但系统中存在一个libmpi库，就表明由于操作系统升级而导致版本冲突。OpenFOAM尝试在安装库时加载该库的版本，但由于操作系统的更新，该库的较新版本替换了较旧的库。

因此，在操作系统升级之后，几乎所有情况下都需要从源头进行完全重建。尤其是当基础操作系统是某种长期版本时，例如每两年发布一次的Ubuntu的LTS版本。较长的OS发布周期，几乎可以保证我们在OS升级后会遇到版本问题。

因此，在升级操作系统之后，我们需要利用如清单18所示的代码从源头进行全部的重建。首先，进入安装目录，使用wclean all清除安装，然后运行Allwmake。请注意，你所有的OpenFOAM安装版本都需要这样重建。
```
cd $WM_PROJECT_DIR
wclean all
./ Allwmake
```
清单 18: 从源头执行完全重建

通常不建议运行旧版本的OpenFOAM，因为它们可能会或将包含早已修复的错误。但是，对于检查之前的模拟或者重新运行它们以将其与当前运行结果进行比较时，还是需要维护多个版本的OpenFOAN,以便随时可以开展工作。
